<div class="container">

    <h1 class="mb-4 text-center text-success font-weight-bold d-flex align-items-center justify-content-center gap-2">
        <i class="fas fa-wallet"></i> Pagos a los Recolectores
    </h1>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <button class="btn btn-outline-success shadow-sm d-flex align-items-center gap-2"
            (click)="mostrarFiltros = !mostrarFiltros">
            <i [ngClass]="mostrarFiltros ? 'fas fa-chevron-up' : 'fas fa-chevron-down'"></i>
            <span>Filtros</span>
        </button>
    </div>


    <div *ngIf="mostrarFiltros" class="p-3 rounded shadow-sm bg-light border">
        <div class="row g-3 align-items-end">
            <div class="">
                <label for="usernameFiltro" class="form-label fw-bold text-secondary">Recolector:</label>
                <input type="text" class="form-control" id="usernameFiltro" placeholder="Buscar por username"
                    [(ngModel)]="usernameFiltro">
            </div>
            <div class="col-md-3">
                <label for="estadoFiltro" class="form-label fw-bold text-secondary">Estado:</label>
                <select class="form-select" id="estadoFiltro" [(ngModel)]="estadoFiltro">
                    <option value="TODOS">Todos</option>
                    <option value="PAGADO">Pagado</option>
                    <option value="PENDIENTE">Pendiente</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="columnaFecha" class="form-label fw-bold text-secondary">Filtrar por fecha:</label>
                <select class="form-select" id="columnaFecha" [(ngModel)]="columnaFecha">
                    <option value="fechaEmision">Fecha de Emisión</option>
                    <option value="fechaPago">Fecha de Pago</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="fechaDesde" class="form-label fw-bold text-secondary">Desde:</label>
                <input type="date" class="form-control" id="fechaDesde" [(ngModel)]="fechaDesde">
            </div>
            <div class="col-md-3">
                <label for="fechaHasta" class="form-label fw-bold text-secondary">Hasta:</label>
                <input type="date" class="form-control" id="fechaHasta" [(ngModel)]="fechaHasta">
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-md-6">
                <button class="btn btn-success btn-block shadow-sm" (click)="aplicarFiltros()">
                    <i class="fas fa-filter"></i> Aplicar Filtros
                </button>
            </div>
            <div class="col-md-6">
                <button class="btn btn-outline-secondary btn-block shadow-sm" (click)="borrarFiltros()">
                    <i class="fas fa-eraser"></i> Borrar Filtros
                </button>
            </div>
        </div>
    </div>

    <table class="table table-bordered table-hover" *ngIf="pagos.totalElements > 0; else noResults">
        <thead style="background-color: #6FBF6D; color: white;">
            <tr>
                <th (click)="cambiarOrden('fechaEmision')" class="text-center">
                    Fecha Emisión
                    <span *ngIf="ordenColumna === 'fechaEmision'">
                        <i [ngClass]="ordenAscendente ? 'fas fa-sort-up' : 'fas fa-sort-down'"></i>
                    </span>
                </th>
                <th (click)="cambiarOrden('fechaPago')" class="text-center">
                    Fecha Pago
                    <span *ngIf="ordenColumna === 'fechaPago'">
                        <i [ngClass]="ordenAscendente ? 'fas fa-sort-up' : 'fas fa-sort-down'"></i>
                    </span>
                </th>
                <th (click)="cambiarOrden('recolector.username')" class="text-center">
                    Recolector
                    <span *ngIf="ordenColumna === 'recolector.username'">
                        <i [ngClass]="ordenAscendente ? 'fas fa-sort-up' : 'fas fa-sort-down'"></i>
                    </span>
                </th>
                <th (click)="cambiarOrden('monto')" class="text-center">
                    Monto
                    <span *ngIf="ordenColumna === 'monto'">
                        <i [ngClass]="ordenAscendente ? 'fas fa-sort-up' : 'fas fa-sort-down'"></i>
                    </span>
                </th>
                <th (click)="cambiarOrden('estado')" class="text-center">
                    Estado
                    <span *ngIf="ordenColumna === 'estado'">
                        <i [ngClass]="ordenAscendente ? 'fas fa-sort-up' : 'fas fa-sort-down'"></i>
                    </span>
                </th>
                <th class="text-center">Acciones</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let pago of pagos?.content">
                <td class="text-center">{{ pago.fechaEmision | date: 'dd/MM/yyyy HH:mm' }}</td>
                <td class="text-center">
                    <span *ngIf="pago.fechaPago; else sinPago">
                        {{ pago.fechaPago | date: 'dd/MM/yyyy HH:mm' }}
                    </span>
                    <ng-template #sinPago>
                        <i class="text-muted">No registrado</i>
                    </ng-template>
                </td>
                <td class="text-center">{{ pago.recolector.username }}</td>
                <td class="text-right">{{ pago.monto | currency }}</td>
                <td class="text-center">
                    <span [ngClass]="{
                        'badge': true,
                        'badge-success': pago.estado === 'PAGADO',
                        'badge-warning text-dark': pago.estado === 'PENDIENTE'
                    }" [style.backgroundColor]="pago.estado === 'PENDIENTE' ? '#FFF4E5' : '#6FBF6D'">
                        {{ pago.estado }}
                    </span>
                </td>
                <td class="text-center">
                    <button class="btn btn-sm btn-info" (click)="redirigirRegistro(pago.registroRecoleccionId)">
                        <i class="fas fa-eye"></i> Registro
                    </button>
                    <button *ngIf="pago.estado === 'PENDIENTE'" class="ml-2 btn btn-sm btn-success"
                        (click)="pagarPago(pago.id)">
                        <i class="fas fa-dollar-sign"></i> Pagar
                    </button>
                </td>
            </tr>
        </tbody>
    </table>

    <ng-template #noResults>
        <div class="alert alert-warning text-center" role="alert">
            <i class="fas fa-exclamation-triangle"></i> No se encontraron pagos del recolector.
        </div>
    </ng-template>
    <app-pagination [totalPages]="pagos.totalPages" [currentPage]="pagos.page" (pageChanged)="cambiarPagina($event)">
    </app-pagination>
</div>