<div class="container mt-4">
    <div class="row align-items-center mb-4">
        <div class="col">
            <h2 class="font-weight-bold">Órdenes de Distribución</h2>
        </div>
        <div class="col-auto">
            <div class="input-group">
                <input type="text" class="form-control" [(ngModel)]="searchTerm" placeholder="Buscar por material"
                    (keyup.enter)="cargarOrdenes(0, pageSize)">
                <div class="input-group-append">
                    <button class="btn btn-info" (click)="cargarOrdenes(0, pageSize)">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div *ngIf="errorMessage" class="alert alert-danger">
        {{ errorMessage }}
    </div>

    <table class="table table-striped" *ngIf="paginatedOrdenes.totalElements > 0; else noResults">
        <thead>
            <tr>
                <th>Num</th>
                <th>Material</th>
                <th>Cantidad</th>
                <th>Depósito</th>
                <th>Estado</th>
                <th>Acción</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let orden of paginatedOrdenes.content">
                <td>#{{ orden.id }}</td>
                <td>{{ orden.material.nombre }}</td>
                <td>{{ orden.cantidad }}</td>
                <td>{{ orden.deposito }}</td>
                <td class="align-middle">
                    <span class="badge d-flex align-items-center justify-content-center" [ngClass]="{
                            'badge-secondary': orden.estado === 'PENDIENTE_DE_ACEPTAR',
                            'badge-info': orden.estado === 'ACEPTADA',
                            'badge-danger': orden.estado === 'RECHAZADO',
                            'badge-warning': orden.estado === 'EN_PREPARACION',
                            'badge-success': orden.estado === 'PREPARADO',
                            'badge-primary': orden.estado === 'ENVIADO'
                          }">
                        <i class="fas me-2" [ngClass]="{
                             'fa-clock': orden.estado === 'PENDIENTE_DE_ACEPTAR',
                             'fa-thumbs-up': orden.estado === 'ACEPTADA',
                             'fa-thumbs-down': orden.estado === 'RECHAZADO',
                             'fa-spinner fa-spin': orden.estado === 'EN_PREPARACION',
                             'fa-check-circle': orden.estado === 'PREPARADO',
                             'fa-truck': orden.estado === 'ENVIADO'
                           }"></i>
                        <span>{{ getEstadoTexto(orden.estado) }}</span>
                    </span>
                </td>
                <td>
                    <button *ngIf="orden.estado === 'ACEPTADA'" class="btn btn-sm btn-warning"
                        (click)="cambiarEstado(orden.id, 'EN_PREPARACION')">
                        En Preparación
                    </button>

                    <button *ngIf="orden.estado === 'EN_PREPARACION'" class="btn btn-sm btn-success"
                        (click)="cambiarEstado(orden.id, 'PREPARADO')">
                        Preparado
                    </button>

                    <button *ngIf="orden.estado === 'PREPARADO'" class="btn btn-sm btn-primary"
                        (click)="cambiarEstado(orden.id, 'ENVIADO')">
                        Enviado
                    </button>
                </td>
            </tr>
        </tbody>
    </table>

    <ng-template #noResults>
        <div class="alert alert-warning text-center" role="alert">
            No se encontraron órdenes.
        </div>
    </ng-template>

    <nav aria-label="Page navigation" *ngIf="paginatedOrdenes && paginatedOrdenes.totalElements > 0">
        <ul class="pagination justify-content-center">
            <li class="page-item" [class.disabled]="paginatedOrdenes.page === 0">
                <button class="page-link" (click)="cambiarPagina(paginatedOrdenes.page - 1)">
                    Anterior
                </button>
            </li>
            <li class="page-item" *ngFor="let page of [].constructor(paginatedOrdenes.totalPages); let i = index"
                [class.active]="i === paginatedOrdenes.page">
                <button class="page-link" (click)="cambiarPagina(i)">
                    {{ i + 1 }}
                </button>
            </li>
            <li class="page-item" [class.disabled]="paginatedOrdenes.page === paginatedOrdenes.totalPages - 1">
                <button class="page-link" (click)="cambiarPagina(paginatedOrdenes.page + 1)">
                    Siguiente
                </button>
            </li>
        </ul>
    </nav>
</div>